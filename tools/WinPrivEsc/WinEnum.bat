::#############################################################
::#  Windows Enumeration & Privilege Escalation Script        #
::#	 Version 0.4 by @rosonsec                                 #
::#  Based on http://www.fuzzysecurity.com/tutorials/16.html  #
::#  Depends on accesshk.exe version with /accepteula allowed #
::#############################################################

@echo off
echo ### WinEnum v0.4 by @rosonsec
echo ########## > WinEnum.txt
echo # SYSTEM # >> WinEnum.txt
echo ########## >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting system information...

echo [-] Hostname >> WinEnum.txt
hostname >> WinEnum.txt
echo. >> WinEnum.txt
echo [-]  systeminfo | findstr /B /C:"OS Name" /C:"OS Version" >> WinEnum.txt 
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" >> WinEnum.txt 
echo. >> WinEnum.txt 


echo ############## >> WinEnum.txt
echo # USER/GROUP # >> WinEnum.txt
echo ############## >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting users/groups information...

echo [-] Username >> WinEnum.txt 
echo %username% >> WinEnum.txt 
whoami >> WinEnum.txt 
echo. >> WinEnum.txt 

echo [-] Local user >> WinEnum.txt 
net user %username% >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt 

echo [-] Domain user >> WinEnum.txt 
net user %username% /domain >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt 


echo [-] Local users >> WinEnum.txt 
net users >> WinEnum.txt 
echo. >> WinEnum.txt 

echo [-] Domain users >> WinEnum.txt 
::net users /domain >> WinEnum.txt 
echo. >> WinEnum.txt 


echo ####################### >> WinEnum.txt
echo # Network Information # >> WinEnum.txt
echo ####################### >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting network information...

echo [-]  Domain info >> WinEnum.txt
net config workstation >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Network and IP info >> WinEnum.txt
ipconfig /all >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Default route >> WinEnum.txt
route print >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  ARP history >> WinEnum.txt
arp -a >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Listening TCP/UDP >> WinEnum.txt
netstat -nao >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Firewall status >> WinEnum.txt
netsh firewall show state >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Firewall configuration >> WinEnum.txt
netsh firewall show config >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Network connections >> WinEnum.txt
net use >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Network shares >> WinEnum.txt
net share >> WinEnum.txt
echo. >> WinEnum.txt


echo ######### >> WinEnum.txt
echo # Tasks # >> WinEnum.txt
echo ######### >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting tasks information...

echo [-]  Scheduled tasks >> WinEnum.txt
schtasks /query /fo LIST /v >> WinEnum.txt
echo. >> WinEnum.txt


echo ############ >> WinEnum.txt
echo # Services # >> WinEnum.txt
echo ############ >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting services information...

echo [-]  Running processes >> WinEnum.txt
tasklist /SVC >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Running services >> WinEnum.txt
net start >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  Drivers >> WinEnum.txt
DRIVERQUERY >> WinEnum.txt
echo. >> WinEnum.txt


echo ####################### >> WinEnum.txt
echo # Vulnerable services # >> WinEnum.txt
echo ####################### >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting services information...

echo [-]  Unquoted service paths >> WinEnum.txt
wmic service get name,displayname,pathname,startmode | findstr /i /v "c:\windows\\" | findstr /i /v """  >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  MSI packages AlwaysInstallElevated (both keys in HKLM and HKCU must be set to 1) >> WinEnum.txt
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated >> WinEnum.txt  2> NUL
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated >> WinEnum.txt  2> NUL
echo. >> WinEnum.txt

echo [-] Insecure service permissions >> WinEnum.txt
::accesschk.exe -uwcqv "Authenticated Users" * /accepteula >> WinEnum.txt
accesschk.exe -uwcqv "Users" * /accepteula >> WinEnum.txt
accesschk.exe -uwcqv "Everyone" * /accepteula >> WinEnum.txt
::accesschk.exe -qdws "Authenticated Users" C:\Windows\ /accepteula  >> WinEnum.txt
accesschk.exe -qdws Users C:\Windows\  >> WinEnum.txt
echo. >> WinEnum.txt

echo [-] Insecure registry permissions >> WinEnum.txt
::accesschk.exe -uwqvks  hklm\System\CurrentControlSet\services /accepteula >> WinEnum.txt
accesschk.exe -uwkqvs Users HKLM\SYSTEM\CurrentControlSet\services /accepteula >> WinEnum.txt
echo. >> WinEnum.txt


echo ############ >> WinEnum.txt
echo # Software # >> WinEnum.txt
echo ############ >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Collecting software information...

echo [-]  Patch level >> WinEnum.txt
wmic qfe get Caption,Description,HotFixID,InstalledOn >> WinEnum.txt
echo. >> WinEnum.txt


echo ##################### >> WinEnum.txt
echo # Interesting files # >> WinEnum.txt
echo ##################### >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Searching for interesting files...

echo [-]  Hosts file >> WinEnum.txt
type c:\windows\system32\drivers\etc\hosts >> WinEnum.txt
echo. >> WinEnum.txt

echo [-]  System preparation files (include passwords) >> WinEnum.txt
dir /s /b sysprep.inf >> WinEnum.txt 2> NUL
dir /s /b sysprep.xml >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt

echo [-]  Unattended install files (include passwords) >> WinEnum.txt
dir /s /b unattended.xml  >> WinEnum.txt 2> NUL
dir /s /b unattend.xml  >> WinEnum.txt 2> NUL
dir /s /b unattend.txt >> WinEnum.txt 2> NUL
dir /s /b autounattend.xml >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt

echo [-]  Other files (include passwords)  >> WinEnum.txt
dir /s /b groups.xml  >> WinEnum.txt 2> NUL
dir /s /b ScheduledTasks.xml  >> WinEnum.txt 2> NUL
dir /s /b printers.xml  >> WinEnum.txt 2> NUL
dir /s /b drives.xml  >> WinEnum.txt 2> NUL
dir /s /b DataSources.xml  >> WinEnum.txt 2> NUL
dir /s /b web.config  >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt

echo [-] Backup SAM files >> WinEnum.txt
dir %systemroot%\repair\SAM >> WinEnum.txt 2>NUL
dir %systemroot%\system32\config\regback\SAM >> WinEnum.txt 2>NUL
echo. >> WinEnum.txt


echo ################### >> WinEnum.txt
echo # String password # >> WinEnum.txt
echo ################### >> WinEnum.txt
echo. >> WinEnum.txt
echo [-] Searching for string password...

echo [-]  String password in the registry >> WinEnum.txt
reg query HKLM /f password /t REG_SZ /s >> WinEnum.txt 2> NUL
reg query HKCU/f password /t REG_SZ /s >> WinEnum.txt 2> NUL
echo. >> WinEnum.txt

echo [-]  String password in filenames >> WinEnum.txt
dir /s /b c:\*pass*  >> WinEnum.txt 2>NUL
dir /s /b c:\*cred*  >> WinEnum.txt 2>NUL
dir /s /b c:\*vnc*  >> WinEnum.txt 2>NUL
dir /s /b c:\*.config  >> WinEnum.txt 2>NUL
echo. >> WinEnum.txt

echo [+] Finished! File WinEnum.txt created
